<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Perro azul 3D con fallback</title>
<style>
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial;background:#f4f6f8;color:#0f172a}
  .wrap{max-width:1100px;margin:0 auto;padding:24px}
  h2{font-size:clamp(24px,3vw,36px);margin:8px 0 6px}
  p.lead{opacity:.8;margin:0 0 18px}
  .section{padding:28px 0}
  #viewer3d{border-radius:16px;overflow:hidden;background:#e5e7eb}
  .badge{display:inline-block;background:#0ea5e9;color:#fff;border-radius:999px;padding:4px 10px;font-size:12px;margin-left:6px}
  /* Fallback SVG styles */
  @keyframes wag{ 0%{transform:rotate(12deg)} 50%{transform:rotate(-12deg)} 100%{transform:rotate(12deg)} }
  @keyframes breathe{ 0%{transform:scale(1,1.00)} 50%{transform:scale(1,1.025)} 100%{transform:scale(1,1.00)} }
  .tail{ transform-origin: 70px 170px; animation: wag .6s ease-in-out infinite; }
  .chest{ transform-origin: 160px 150px; animation: breathe 2.2s ease-in-out infinite; }
</style>
</head>
<body>
  <div class="wrap">
    <section class="section">
      <h2>Conoce a nuestro compañero <span class="badge">3D</span></h2>
      <p class="lead">Si tu navegador/hosting no soporta el 3D, verás una animación en 2D.</p>
      <div id="viewer3d">
        <canvas id="canvas3d" style="width:100%;height:540px;display:block;"></canvas>
      </div>
      <div id="fallback" style="display:none;padding:18px;border-radius:16px;background:#e5e7eb;margin-top:12px">
        <svg viewBox="0 0 320 240" xmlns="http://www.w3.org/2000/svg" aria-label="Perro azul animado">
          <defs>
            <linearGradient id="fur" x1="0" x2="1">
              <stop offset="0%" stop-color="#1e40ff"/><stop offset="100%" stop-color="#172fb3"/>
            </linearGradient>
          </defs>
          <ellipse cx="160" cy="210" rx="120" ry="18" fill="#dcdcdc"/>
          <g class="tail"><rect x="64" y="160" width="80" height="10" rx="5" fill="#172fb3"/></g>
          <ellipse cx="160" cy="170" rx="90" ry="55" fill="url(#fur)"/>
          <ellipse class="chest" cx="185" cy="170" rx="58" ry="38" fill="#4f6bff" opacity="0.9"/>
          <rect x="190" y="190" width="18" height="45" rx="9" fill="#172fb3"/>
          <rect x="215" y="190" width="18" height="45" rx="9" fill="#172fb3"/>
          <ellipse cx="110" cy="195" rx="26" ry="22" fill="#1e40ff"/>
          <ellipse cx="130" cy="195" rx="26" ry="22" fill="#1e40ff"/>
          <circle cx="240" cy="120" r="40" fill="url(#fur)"/>
          <ellipse cx="265" cy="130" rx="25" ry="18" fill="#172fb3"/>
          <circle cx="280" cy="125" r="6" fill="#222"/>
          <polygon points="225,85 235,60 245,85" fill="#172fb3"/>
          <polygon points="255,85 265,60 275,85" fill="#172fb3"/>
          <circle cx="245" cy="115" r="9" fill="#fafafa"/>
          <circle cx="248" cy="117" r="4" fill="#111"/>
        </svg>
      </div>
    </section>
  </div>

  <!-- Intentar cargar librerías locales ultracompatibles -->
  <script src="three.min.js"></script>
  <script src="OrbitControls.js"></script>
  <script>
  (function(){
    if(typeof THREE==='undefined' || typeof THREE.OrbitControls==='undefined'){
      document.getElementById('viewer3d').style.display='none';
      document.getElementById('fallback').style.display='block';
      return;
    }
    var canvas = document.getElementById('canvas3d');
    var renderer = new THREE.WebGLRenderer({canvas:canvas, antialias:true, alpha:false});
    renderer.setPixelRatio(Math.min(window.devicePixelRatio||1,2));
    function resize(){
      var w = canvas.clientWidth, h = canvas.clientHeight;
      renderer.setSize(w,h,false);
      camera.aspect = w/h; camera.updateProjectionMatrix();
    }
    var scene = new THREE.Scene();
    scene.background = new THREE.Color(0xECECEC);
    var camera = new THREE.PerspectiveCamera(50, 16/9, 0.1, 100);
    camera.position.set(1.4,1.0,2.2);
    var controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true; controls.target.set(0,0.7,0);
    scene.add(new THREE.HemisphereLight(0xffffff, 0x445566, 1.0));
    var dir = new THREE.DirectionalLight(0xffffff, 1.1); dir.position.set(3,5,2); scene.add(dir);
    var BLUE_MAIN = 0x1e40ff, BLUE_DARK = 0x172fb3, BLUE_LIGHT=0x4f6bff;
    var fur = new THREE.MeshStandardMaterial({color:BLUE_MAIN, metalness:0.05, roughness:0.9});
    var furDark = new THREE.MeshStandardMaterial({color:BLUE_DARK, metalness:0.05, roughness:0.95});
    var furLight = new THREE.MeshStandardMaterial({color:BLUE_LIGHT, metalness:0.05, roughness:0.9});
    var noseMat = new THREE.MeshStandardMaterial({color:0x222222, metalness:0.3, roughness:0.6});
    var eyeWhite= new THREE.MeshStandardMaterial({color:0xfafafa, metalness:0.0, roughness:0.4});
    var eyeBlack= new THREE.MeshStandardMaterial({color:0x111111, metalness:0.7, roughness:0.4});
    var dog = new THREE.Group(); scene.add(dog);
    var body = new THREE.Mesh(new THREE.SphereGeometry(0.5, 24, 24), fur); body.position.set(0,0.5,0); dog.add(body);
    var chest= new THREE.Mesh(new THREE.SphereGeometry(0.42, 24, 24), furLight); chest.position.set(0.05,0.53,0.12); dog.add(chest);
    var head = new THREE.Mesh(new THREE.SphereGeometry(0.32, 24, 24), fur); head.position.set(0.35,0.95,0.0); dog.add(head);
    var snout= new THREE.Mesh(new THREE.SphereGeometry(0.18, 16, 16), furDark); snout.position.set(0.48,0.88,0); snout.scale.set(1.2,0.8,0.9); dog.add(snout);
    var nose = new THREE.Mesh(new THREE.SphereGeometry(0.06, 12, 12), noseMat); nose.position.set(0.58,0.86,0); dog.add(nose);
    var earGeo = new THREE.ConeGeometry(0.12,0.22, 16);
    var earL = new THREE.Mesh(earGeo, furDark); earL.position.set(0.28,1.06,-0.12); earL.rotation.z=Math.PI*0.1; dog.add(earL);
    var earR = earL.clone(); earR.position.z=0.12; earR.rotation.z=-Math.PI*0.1; dog.add(earR);
    var eyeL = new THREE.Mesh(new THREE.SphereGeometry(0.06, 12, 12), eyeWhite); eyeL.position.set(0.41,0.95,-0.08);
    var pupilL = new THREE.Mesh(new THREE.SphereGeometry(0.03, 10, 10), eyeBlack); pupilL.position.set(0.05,-0.005,0.02); eyeL.add(pupilL); dog.add(eyeL);
    var eyeR = eyeL.clone(); eyeR.position.z=0.08; dog.add(eyeR);
    var legGeo = new THREE.CylinderGeometry(0.08,0.09,0.35, 12);
    function leg(x,z,mat){ var m=new THREE.Mesh(legGeo, mat||furDark); m.position.set(x,0.28,z); return m; }
    dog.add(leg(0.1,-0.18)); dog.add(leg(0.1,0.18));
    var thighGeo = new THREE.SphereGeometry(0.22, 16, 16, 0, Math.PI*2, 0, Math.PI/2);
    var thighL = new THREE.Mesh(thighGeo, fur); thighL.position.set(-0.18,0.35,-0.16); dog.add(thighL);
    var thighR = thighL.clone(); thighR.position.z=0.16; dog.add(thighR);
    var tailGeo = new THREE.CylinderGeometry(0.035,0.05,0.6, 10);
    var tail = new THREE.Mesh(tailGeo, furDark);
    var tailPivot = new THREE.Group(); tailPivot.position.set(-0.45,0.70,0);
    tail.rotation.z = Math.PI/2.3; tailPivot.add(tail); dog.add(tailPivot);
    var ground = new THREE.Mesh(new THREE.CircleGeometry(2.2, 28), new THREE.MeshStandardMaterial({color:0xdcdcdc, roughness:0.95}));
    ground.rotation.x = -Math.PI/2; ground.position.y=0; scene.add(ground);
    function animate(){
      requestAnimationFrame(animate);
      var t = performance.now()*0.001;
      var breathe = 1 + Math.sin(t*1.2)*0.02;
      body.scale.set(1, breathe, 1);
      chest.scale.set(1.02, 1 + Math.sin(t*1.2)*0.025, 1.02);
      tailPivot.rotation.y = Math.sin(t*6.0)*0.5;
      controls.update(); renderer.render(scene,camera);
    }
    window.addEventListener('resize', resize);
    resize(); animate();
  })();
  </script>
</body>
</html>
